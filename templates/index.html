{% extends "base.html" %}

{% block content %}
<header>
    <h1>Telegram –ê–∫–∫–∞—É–Ω—Ç—ã</h1>
    <div class="user-info">
        <span>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, {{ session.email }}</span>
        <div class="header-buttons">
            <a href="{{ url_for('profile') }}" class="btn-profile">–ü—Ä–æ—Ñ–∏–ª—å</a>
            <a href="{{ url_for('logout') }}" class="btn-logout">–í—ã–π—Ç–∏</a>
        </div>
    </div>
</header>

<main>
    <!-- –ü–æ–∏—Å–∫ -->
    <div class="search-container">
        <form method="GET" action="{{ url_for('index') }}" class="search-form">
            <input type="text" name="search" placeholder="–ü–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–æ–≤..." value="{{ search_query }}" 
                   class="search-input">
            <button type="submit" class="search-btn">–ù–∞–π—Ç–∏</button>
            {% if search_query %}
            <a href="{{ url_for('index') }}" class="clear-search">–û—á–∏—Å—Ç–∏—Ç—å</a>
            {% endif %}
        </form>
    </div>

    <!-- –¢–æ–≤–∞—Ä—ã -->
    <div class="products-grid">
        {% for product in products %}
        <div class="product-card {% if not product.available %}unavailable{% endif %}" 
             data-product-id="{{ product.id }}">
            <h3>{{ product.name }}</h3>
            <div class="price-container">
                {% if product.sale %}
                <span class="original-price">{{ product.original_price }}</span>
                <span class="sale-badge">{{ product.sale }}</span>
                {% endif %}
                <span class="price">{{ product.price }}</span>
            </div>
            <div class="product-views">
                üëÅÔ∏è –ü—Ä–æ—Å–º–æ—Ç—Ä–æ–≤: <span class="views-count">{{ product.views }}</span>
            </div>
            <a href="https://t.me/Followhqq" class="btn-buy {% if not product.available %}disabled{% endif %}" 
               target="_blank" {% if not product.available %}onclick="return false;"{% endif %}>
                {% if product.available %}–ö—É–ø–∏—Ç—å –≤ Telegram{% else %}–ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏{% endif %}
            </a>
        </div>
        {% endfor %}
    </div>
    
    {% if not products %}
    <div class="no-products">
        <p>–¢–æ–≤–∞—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å.</p>
    </div>
    {% endif %}
    
    <div class="update-notice">
        <p>‚ö†Ô∏è –í –±—É–¥—É—â–µ–º –±—É–¥—É—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–æ–≤ ‚ö†Ô∏è</p>
        <p>‚ö†Ô∏è –í –±—É–¥—É—â–µ–º –ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è –ø—Ä–æ–¥–∞–∂–∞ –ø—Ä–æ–∫—Å–∏!!! ‚ö†Ô∏è</p>
    </div>

    <!-- –°–∏—Å—Ç–µ–º–∞ –æ—Ç–∑—ã–≤–æ–≤ -->
    <section class="reviews-section">
        <h2>–û—Ç–∑—ã–≤—ã –ø–æ–∫—É–ø–∞—Ç–µ–ª–µ–π</h2>
        
        <!-- –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –æ—Ç–∑—ã–≤–∞ -->
        {% if current_user.is_authenticated %}
        <div class="add-review-form">
            <h3>–û—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤</h3>
            <form id="reviewForm">
                <div class="form-group">
                    <select name="product_name" required class="review-select">
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–æ–≤–∞—Ä</option>
                        <option value="–ê–∫–∫–∞—É–Ω—Ç Telegram –ú—å—è–Ω–º–∞(+95)">–ê–∫–∫–∞—É–Ω—Ç Telegram –ú—å—è–Ω–º–∞(+95)</option>
                        <option value="–ê–∫–∫–∞—É–Ω—Ç Telegram –ë–∞–Ω–≥–ª–∞–¥–µ—à(+880)">–ê–∫–∫–∞—É–Ω—Ç Telegram –ë–∞–Ω–≥–ª–∞–¥–µ—à(+880)</option>
                        <option value="–ê–∫–∫–∞—É–Ω—Ç Telegram –°–®–ê(–≤–∏—Ä—Ç)(+1)">–ê–∫–∫–∞—É–Ω—Ç Telegram –°–®–ê(–≤–∏—Ä—Ç)(+1)</option>
                        <option value="–ê–∫–∫–∞—É–Ω—Ç Telegram –ù–∏–≥–µ—Ä–∏—è(+234)">–ê–∫–∫–∞—É–Ω—Ç Telegram –ù–∏–≥–µ—Ä–∏—è(+234)</option>
                    </select>
                </div>
                <div class="form-group">
                    <div class="rating-stars">
                        <span>–û—Ü–µ–Ω–∫–∞:</span>
                        {% for i in range(5, 0, -1) %}
                        <input type="radio" name="rating" value="{{ i }}" id="star{{ i }}">
                        <label for="star{{ i }}">‚òÖ</label>
                        {% endfor %}
                    </div>
                </div>
                <div class="form-group">
                    <textarea name="content" placeholder="–í–∞—à –æ—Ç–∑—ã–≤..." required 
                              maxlength="500" class="review-textarea"></textarea>
                </div>
                <button type="submit" class="btn-submit-review">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤</button>
            </form>
        </div>
        {% else %}
        <p class="auth-required">–ß—Ç–æ–±—ã –æ—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤, <a href="{{ url_for('login') }}">–≤–æ–π–¥–∏—Ç–µ</a> –≤ –∞–∫–∫–∞—É–Ω—Ç</p>
        {% endif %}

        <!-- –°–ø–∏—Å–æ–∫ –æ—Ç–∑—ã–≤–æ–≤ -->
        <div class="reviews-list">
            {% if reviews %}
                {% for review in reviews %}
                <div class="review-item">
                    <div class="review-header">
                        <strong>{{ review.author.email }}</strong>
                        <span class="review-product">{{ review.product_name }}</span>
                        <div class="review-rating">
                            {% for i in range(5) %}
                            <span class="star {% if i < review.rating %}filled{% endif %}">‚òÖ</span>
                            {% endfor %}
                        </div>
                    </div>
                    <p class="review-content">{{ review.content }}</p>
                    <div class="review-footer">
                        <span class="review-date">{{ review.created_at.strftime('%d.%m.%Y %H:%M') }}</span>
                    </div>
                </div>
                {% endfor %}
            {% else %}
                <p class="no-reviews">–ü–æ–∫–∞ –Ω–µ—Ç –æ—Ç–∑—ã–≤–æ–≤. –ë—É–¥—å—Ç–µ –ø–µ—Ä–≤—ã–º!</p>
            {% endif %}
        </div>
    </section>
</main>

<footer>
    <p>–ü–æ –≤—Å–µ–º –±–∞–≥–∞–º, –æ—à–∏–±–∫–∞–º, –Ω–µ–ø–æ–Ω—è—Ç–∫–∞–º, –≤–æ–∑–≤—Ä–∞—Ç—É —Ç–æ–≤–∞—Ä–∞ –ø–∏—Å–∞—Ç—å –≤ —Ç–µ–ª–µ–≥—Ä–∞–º <a href="https://t.me/Xr4kqq" target="_blank">@Xr4kqq</a></p>
</footer>
{% endblock %}